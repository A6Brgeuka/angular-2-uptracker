<form class="uptracker-form" (ngSubmit)="saveReconcile()" materialize #reconcileProductForm="ngForm" autocomplete="off" novalidate>
  <div class="top">
    <div class="row filter clearfix">
      <div class="col l3 m6 title">
        <span class="main-title">Reconcile Invoice</span>
      </div>
      <div class="col l3 m6">
        <ngx-select-dropdown 
          *ngIf="invoices.length > 0"
          [config]="selectConfig"
          [options]="invoices"
          [(value)]="invoices_"
          [multiple]="false"
          (ngModelChange)="invoiceChange($event)"
        >
        </ngx-select-dropdown>
      </div>
    </div>

    <div class="invoice">
      <div class="row bottom-border">
        <div class="col l6 left">
          <div class="row input-header"><span>Invoice Date</span></div>
          <div class="row date-picker">
            <input
              type="text"
              name="datePicker"
              [(ngModel)]="selectedInvoice.placed_date"
            />
            <div class="calendar">
              <img src="/assets/img/icon-calendar.png" alt="" />
            </div>
          </div>
          <div class="row input-header"><span>Currency</span></div>
          <div class="row">
            <div class="currency">
              <span>{{this.getDollarSign()}}1.00</span>
              <div class="select">
                <select
                  class="wide"
                  materialize="material_select"
                  [materializeSelectOptions]=""
                  name="currency"
                  [(ngModel)]="selectedInvoice.currency"
                  (ngModelChange)="dollarSignChange($event)"
                >
                  <option value="USD">USD</option>
                  <option value="CAD">CAD</option>
                  <option value="MXN">MXN</option>
                  <option value="JPY">JPY</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row"><span>Exchange rate</span></div>
        </div>
        <div class="col l6 right">
          <div class="row">
            <div class="item">
              <span>Calculated Sub-Total</span>
              <div class="input-calculated">
                {{selectedInvoice.calculated_sub_total}}
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Invoiced Sub-Total</span>
              <div>
                <div class="input">
                  <input
                    type="text"
                    name="subTotal"
                    placeholder="$0.00"
                    currencyMask
                    [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                    [(ngModel)]="selectedInvoice.invoiced_sub_total"
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Invoice Credit</span>
              <div>
                <div class="input">
                  <input
                    type="text"
                    name="invoiceCredit"
                    placeholder="$0.00"
                    currencyMask
                    [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                    [(ngModel)]="selectedInvoice.invoice_credit"
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Shipping</span>
              <div>
                <div class="input">
                  <input
                    type="text"
                    name="shipping"
                    placeholder="$0.00"
                    currencyMask
                    [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                    [(ngModel)]="selectedInvoice.shipping"
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Handling</span>
              <div>
                <div class="input">
                  <input
                    type="text"
                    name="handling"
                    placeholder="$5.00"
                    currencyMask
                    [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                    [(ngModel)]="selectedInvoice.handling"
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Taxes</span>
              <div class="input-taxes">
                <input type="text" name="taxes" [(ngModel)]="selectedInvoice.taxes">
                <div class="plus" (click)="taxBoardVisible = !taxBoardVisible">
                  <fa name="plus"></fa>
                </div>
                <div class="tax-board" *ngIf="taxBoardVisible">
                  <div class="row">
                    <div class="col s5"><span>Sales Tax</span></div>
                    <div class="col s7 input"><input type="text" name="salestax" value="$5.00"></div>
                  </div>
                  <div class="row">
                    <div class="col s5"><span>VAT</span></div>
                    <div class="col s7 input"><input type="text" name="vat" value="$5.00"></div>
                  </div>
                  <div class="row button">
                    <button class="btn white-text" (click)="taxBoardClick()">
                      <span>OK</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>P.O. Discount</span>
              <div class="input-discount">
                <input type="text" name="discount" [(ngModel)]="selectedInvoice.po_discount">
                <div class="select">
                  <select
                    class="wide"
                    materialize="material_select"
                    [materializeSelectOptions]=""
                    name="currency"
                    [(ngModel)]="selectedInvoice.po_discount_type"
                  >
                    <option value="PERCENT">%</option>
                    <option value="selectedInvoice.currency">{{DOLLARSIGNS[selectedInvoice.currency]}}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col l6 left">
          <button
            type="submit"
            class="uptracker-form-btn no-min-width white-text waves-effect waves-light"
          >
            UPDATE DETAILS
          </button>
        </div>
        <div class="col l6 right">
          <div class="row">
            <div class="item">
              <span>Total</span>
              <div class="input-calculated">
                <span class="bold">{{selectedInvoice.total}}</span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span>Calculated Total</span>
              <div class="input-calculated">
                {{this.getCalculatedTotal()}}
              </div>
            </div>
          </div>
          <div class="row">
            <div class="item">
              <span class="diff-red">Diff</span>
              <div class="input-calculated">
                <span class="diff-red">{{this.getDiff()}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="control">
      <div class="input wide-input">
        <input type="text" name="filterInput" [(ngModel)]="filter" (ngModelChange)="filterChange($event)">
      </div>
      <div class="select">
        <select title="sort by" name="sort" [(ngModel)]="sort" materialize="material_select"  (ngModelChange)="sortAlphabet($event)">
          <option value="A-Z">A-Z</option>
          <option value="Z-A">Z-A</option>
        </select>
      </div>
      <div class="filter">
        <a (click)="openFilterModal()">
          <fa [name]="'filter'"></fa>
          <span>Filters</span>
        </a>
      </div>
      <button
        (click)="addProduct()"
        class="right mtop uptracker-form-btn white-text waves-effect waves-light"
      >
        Add Product
      </button>
    </div>

    <div class="list is-grid-view">
      <div class="heading row">
        <div class="col s3 left-align">
          <div class="left product">
            Product
          </div>
        </div>
        <div class="col s8">
          <div class="row mrg-btm-0">
            <div class="col s2">Pkg</div>
            <div class="col s1">QTY</div>
            <div class="col s2">Pkg Price</div>
            <div class="col s3">Discount</div>
            <div class="col s2">Disc Price</div>
            <div class="col s2">Total Price</div>
          </div>
        </div>
        <div class="col s1">
        </div>
      </div>
    </div>

    <ng-container *ngFor="let product of selectedInvoice.order_items; let i = index">
      <div class="item row"  *ngIf="filtered(product)">
        <div class="table-item flex-center">
          <div class="col s3 left-align flex-center">
            <div class="input-checkbox left checkbox">
              <input
                type="checkbox"
                class="checkbox-input"
                id="selectProduct{{i}}"
                name="selectProduct{{i}}"
                [(ngModel)]="product.checked"
                (click)="productSelect(product)"
              />
              <label for="selectProduct{{i}}"></label>
            </div>
            <div class="product-pic"></div>
            <div class="left">
              <a>{{product.item_name}}</a>
            </div>
          </div>

          <div class="col s8">
            <div class="row mrg-btm-0 flex-center">
              <div class="col s2">
                <div class="text-left input-header">{{product.package}}</div>
              </div>
              <div class="col s1">
                <div class="text-left mini-input input-header">{{product.qty}}</div>
              </div>
              <div class="col s2">
                <div class="text-left input-header">{{product.package_price}}</div>
              </div>
              <div class="col s3">
                <div class="text-left input-header">{{product.discount}}</div>
              </div>
              <div class="col s2">
                <div>{{product.disc_price}}</div>
              </div>
              <div class="col s2">
                <div>{{product.total}}</div>
              </div>
            </div>
            <div class="row mrg-btm-0">
              <div class="col s2">
                <div class="select">
                  <select title="Pkg" name="pkg" [(ngModel)]="product.package_" materialize="material_select">
                    <option value="Box">Box</option>
                    <option value="Glove">Glove</option>
                  </select>
                </div>
              </div>
              <div class="col s1">
                <div class="input mini-input">
                  <input class="text-left" name="QTY{{i}}" type="text" [(ngModel)]="product.qty_">
                </div>
              </div>
              <div class="col s2">
                <div class="input">
                  <input
                    class="text-left"
                    name="PKGP{{i}}"
                    type="text"
                    currencyMask
                    [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                    [(ngModel)]="product.package_price_"
                  >
                </div>
              </div>
              <div class="col s3">
                <div class="discount">
                  <div class="input">
                    <input
                      class="text-left"
                      name="DT{{i}}"
                      type="text"
                      currencyMask
                      [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                      [(ngModel)]="product.discount_"
                    >
                  </div>
                  <div class="select">
                    <select
                      class="wide"
                      materialize="material_select"
                      [materializeSelectOptions]=""
                      name="currency"
                      [(ngModel)]="selectedInvoice.discountType"
                    >
                      <option value="PERCENT">%</option>
                      <option value="selectedInvoice.currency">{{DOLLARSIGNS[selectedInvoice.currency]}}</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="col s2">
                <div class="lined">{{product.disc_price_}}</div>
              </div>
              <div class="col s2">
                <div class="lined">{{product.total_}}</div>
              </div>
            </div>
          </div>

          <div class="col s1 flex-center justify-center trash-icon">
            <a>
              <fa name="ellipsis-h" class="tealish-text"></fa>
            </a>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="panel" [class.active]="panelVisible">
    <div class="active-area">
      <div class="title">Bulk Updates</div>
      <div class="list-area">
        <ng-container *ngFor="let product of selectedInvoice.order_items; let i = index">
          <div class="product-list" *ngIf="product.checked">
            <div class="row">
              <span>{{product.item_name}}</span>
            </div>
            <div class="remove">
              <a (click)="removeProduct(product)">Remove</a>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="board">
        <div class="row">
          <div class="col s4"><span class="board-title">Pkg</span></div>
          <div class="col s8">
            <div class="select">
              <select title="Pkg" name="board-pkg" [(ngModel)]="board.Pkg" materialize="material_select">
                <option value="Box">Box</option>
                <option value="Glove">Glove</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col s4"><span class="board-title">QTY</span></div>
          <div class="col s8">
            <div class="input">
              <input
                class="text-left"
                name="board-qty"
                type="text"
                currencyMask
                [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                [(ngModel)]="board.qty"
              >
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col s4"><span class="board-title">Pkg Price</span></div>
          <div class="col s8">
            <div class="input">
              <input
                class="text-left"
                name="board-qty"
                type="text"
                currencyMask
                [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                [(ngModel)]="board.pkgPrice"
              >
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col s4"><span class="board-title">Discount</span></div>
          <div class="col s8">
            <div class="discount">
              <div class="input">
                <input
                  class="text-left"
                  name="DT{{i}}"
                  type="text"
                  currencyMask
                  [options]="{ prefix: '$', thousands: ',', decimal: '.', align: 'left' }"
                  [(ngModel)]="board.discountAmount"
                >
              </div>
              <div class="select">
                <select
                  class="wide"
                  materialize="material_select"
                  [materializeSelectOptions]=""
                  name="currency"
                  [(ngModel)]="board.discountType"
                >
                  <option value="PERCENT">%</option>
                  <option value="selectedInvoice.currency">{{DOLLARSIGNS[selectedInvoice.currency]}}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="row center">
          <button class="update" (click)="bulkUpdates()">UPDATE</button>
        </div>
        <div class="row center">
          <a class="nevermind" (click)="bulkNevermind()">Nevermind</a>
        </div>
      </div>
    </div>
  </div>
</form>