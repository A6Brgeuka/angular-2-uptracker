<div class="close" (click)="dismissModal()"></div>
<div class="inner" [ngClass]="{'edit-mode':showEdit}">
  <div class="title center-align">{{product.name}}</div>
  <div class="row center edit-buttons">
    <button class="bt-edit-product edbtn bluebtn" *ngIf="!showEdit" (click)="showEditFields()">
      <fa [name]="'pencil'"></fa>
      Edit
    </button>
    <button class="bt-edit-product-save edbtn bluebtn" (click)="saveAfterEdit()" *ngIf="showEdit">
      <fa [name]="'check'"></fa>
      Save
    </button>
    <button class="bt-edit-product-cancel edbtn redbtn" *ngIf="showEdit" (click)="closeEditFields()">
      <fa [name]="'close'"></fa>
      Cancel
    </button>
  </div>
  <div class="row uptracker-form">
    <div class="col s12 m3">
      <div class="img-container">
        <div class="img" *ngIf="product?.image"
          [ngStyle]="{ 'background-image': 'url(' + product?.image + ')' }"></div>
      </div>
    </div>
    <div class="info-box col s12 m9">
      <div class="ttl-box row input">
        <div *ngIf="!showEdit" class="ttl col s12">{{product.name}}</div>
        <div class="col s12">
          <input class="ttl col s12 name-field" *ngIf="showEdit" [(ngModel)]="productCopy.name" type="text">
        </div>
      </div>
      <div class="row" [ngClass]="{'checks':showEdit}">

        <div class="col s4 ">
          <div *ngIf="!showEdit" class="">
            <label>Hazardous</label>
            <span class="value">{{product.hazardous_string}}</span>
          </div>
          <div *ngIf="showEdit" class="input-checkbox checkbox">
            <label>Hazardous</label>
            <input
              type="checkbox"
              class="checkbox-input"
              [(ngModel)]="productCopy.hazardous"
              id="checkbox1"
            />
            <label for="checkbox1"></label>
          </div>
        </div>

        <div class="col s4 ">
          <div *ngIf="!showEdit" class="">
            <label>Trackable</label>
            <span class="value">{{product.trackable_string}}</span>
          </div>
          <div *ngIf="showEdit" class="input-checkbox checkbox">
            <label>Trackable</label>
            <input
              type="checkbox"
              class="checkbox-input"
              [(ngModel)]="productCopy.trackable"
              id="checkbox2"
            />
            <label for="checkbox2"></label>
          </div>
        </div>

        <div class="col s4 ">
          <div *ngIf="!showEdit" class="">
            <label>Tax Exempt</label>
            <span class="value">{{product.tax_exempt_string}}</span>
          </div>
          <div *ngIf="showEdit" class="input-checkbox checkbox">
            <label>Tax Exempt</label>
            <input
              type="checkbox"
              class="checkbox-input"
              [(ngModel)]="productCopy.tax_exempt"
              id="checkbox3"
            />
            <label for="checkbox3"></label>
          </div>
        </div>

      </div>
      <div class="row">

        <div class="col s4 input">
          <label>Department</label>
          <div *ngIf="!showEdit" class="value">{{product.department}}</div>
          <div *ngIf="showEdit" class="select">
            <select
              [(ngModel)]="productCopy.department"
              materialize="material_select"
              [materializeSelectOptions]="departmentCollection$ | async">
              <option *ngFor="let item of departmentCollection$ | async" [value]="item">{{item}}</option>
            </select>
          </div>
        </div>

        <div class="col s4 input">
          <label>Category</label>
          <div *ngIf="!showEdit" class="value">{{product.category}}</div>
          <div *ngIf="showEdit" class="select">
            <select
              [(ngModel)]="productCopy.category"
              materialize="material_select"
              [materializeSelectOptions]="productCategoriesCollection$ | async">
              <option *ngFor="let cat of productCategoriesCollection$ | async" [value]="cat">{{cat}}
              </option>
            </select>
          </div>
        </div>

        <div class="col s4 input">
          <label>Accounting</label>
          <div *ngIf="!showEdit" class="value">{{product.account_category}}</div>
          <div *ngIf="showEdit" class="select">
            <select
              [(ngModel)]="productCopy.account_category"
              materialize="material_select"
              [materializeSelectOptions]="productAccountingCollection$ | async">
              <option *ngFor="let acc of productAccountingCollection$ | async" [value]="acc">{{acc}}
              </option>
            </select>
          </div>
        </div>

      </div>
    </div>
  </div>


  <div class="row">
    <div class="col s12">
      <ul class="tabs" materialize="tabs">
        <li class="tab col s2">
          <a href="#variations">Variations</a>
        </li>
        <li class="tab col s2">
          <a href="#info">Info</a>
        </li>
        <li class="tab col s2">
          <a href="#inventory">Inventory</a>
        </li>
        <li class="tab col s2" *ngIf="product.trackable">
          <a href="#tracking">Tracking</a>
        </li>
        <li class="tab col s2">
          <a href="#history">Order History</a>
        </li>
        <li class="tab col s2">
          <a href="#comments">Comments</a>
        </li>
      </ul>
    </div>
  </div>


  <div id="variations">
    <div class="inner">
      <div class="variant-table">
        <div class="uptracker-form variant-head">
          <div class="variant-checkbox head-item">
            <div class="checkbox input-checkbox ">
              <input
                type="checkbox"
                class="checkbox-input"
                [(ngModel)]="variation.checked"
                (change)="headCheckboxChange()"
                id="variation-checkbox"
              />
              <label for="variation-checkbox"></label>
            </div>
          </div>
          <div class="name-heading head-item">
            <div class="input">
              <input
                type="text"
                class="name-input"
                ngModel
                (input)="changeName($event)"
                placeholder="Name"
                #name="ngModel"/>
            </div>
          </div>
          <div class="small-heading head-item">
            <div class="select">
              <select
                [(ngModel)]="variation.package_type"
                #pkg="ngModel"
                materialize="material_select"
                (change)="changePkg($event)"
                [materializeSelectOptions]="variationArrs.package_type">
                <option value="">Pkg</option>
                <option *ngFor="let item of variationArrs.package_type" [value]="item">{{item}}</option>
              </select>
            </div>
          </div>
          <div class="small-heading head-item">
            <div class="select">
              <select
                [(ngModel)]="variation.unit_type"
                #unit="ngModel"
                materialize="material_select"
                (change)="changeUnit($event)"
                [materializeSelectOptions]="variationArrs.unit_type">
                <option value="">Unit</option>
                <option *ngFor="let item of variationArrs.unit_type" [value]="item">{{item}}</option>
              </select>
            </div>
          </div>
          <div class="small-heading head-item">
            <div class="select">
              <select
                [(ngModel)]="variation.units_per_package"
                #units_pkg="ngModel"
                materialize="material_select"
                (change)="changeUnitsPkg($event)"
                [materializeSelectOptions]="variationArrs.units_per_package">
                <option value="">Qty</option>
                <option *ngFor="let item of variationArrs.units_per_package" [value]="item">{{item}}
                </option>
              </select>
            </div>
          </div>
          <div class="small-heading head-item">
            <div class="select">
              <select
                [(ngModel)]="variation.size"
                #size="ngModel"
                materialize="material_select"
                (change)="changeSize($event)"
                [materializeSelectOptions]="variationArrs.size">
                <option value="">Size</option>
                <option *ngFor="let item of variationArrs.size" [value]="item">{{item}}</option>
              </select>
            </div>
          </div>

          <div class="text-heading valign-wrapper head-item">
            <div class="text-head valign">
              UPC
            </div>
          </div>
          <div class="text-heading valign-wrapper head-item">
            <div class="text-head valign">
              Price Range
            </div>
          </div>
          <div class="flor">
            <div *ngIf="!showEdit" class="add-order-heading head-item">
              <button
                class="uptracker-form-btn waves-light waves-effect add-order-btn"
                [disabled]="!addOrderVariantsButtonShow">
                <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                Add to Order
              </button>
            </div>
            <div *ngIf="showEdit" class="visibility-heading head-item">
              <i class="material-icons noselect" (click)="toggleVariationVisibility()">
                {{variation.status != 2 ? "visibility" : "visibility_off"}}
              </i>
            </div>
            <div class="filter-heading noselect head-item">
              <fa [name]="'filter'"></fa>
            </div>
          </div>

          <div class="clearfix"></div>
        </div>
      </div>

      <div class="table-body">
        <div class="variant-table">
          <div class="uptracker-form  table-item" *ngFor="let variant of filteredVariants$ | async">
            <div class="variant-checkbox row-item">
              <div class="checkbox input-checkbox">
                <input
                  type="checkbox"
                  class="checkbox-input"
                  [(ngModel)]="variant.checked"
                  (change)="variantCheckedChange()"
                  id="{{variant.id}}"
                />
                <label for="{{variant.id}}"></label>
              </div>
            </div>
            <div class="name-heading variant-name row-item valign-wrapper">
                            <span [class.reddish]="variant.status == 2" class="valign"
                              (click)="toggleVariantDetailView(variant)">{{variant.name || "Product Here"}}</span>
            </div>
            <div class="small-heading row-item">{{variant.package_type || ""}}</div>
            <div class="small-heading row-item">{{variant.unit_type || ""}}</div>
            <div class="small-heading row-item">{{variant.units_per_package || ""}}</div>
            <div class="small-heading row-item">{{variant.size || ""}}</div>
            <div class="text-heading row-item">{{variant.upc || ""}}</div>
            <div class="text-heading row-item">{{variant.price_range || ""}}</div>
            <div class="flor">
              <div *ngIf="showEdit" class="edit-variant visibility-heading row-item">
                <i class="fa fa-eye  variant-func"
                  [class.fa-eye]="variant.status == 1"
                  [class.fa-eye-slash]="variant.status == 2"
                  (click)="toggleVariantVisibility(variant)"
                  aria-hidden="true"></i>
              </div>
              <div *ngIf="showEdit"
                class="edit-variant filter-heading row-item"
                (click)="toggleVariantDetailView(variant)">
                <i class="fa fa-pencil variant-func" aria-hidden="true"></i>
              </div>
              <div *ngIf="!showEdit" class="add-order-col add-order-heading row-item">
                <button class=" variant-func uptracker-form-btn waves-light waves-effect add-order-btn">
                  <i
                    class="fa fa-shopping-cart" aria-hidden="true"></i>
                  Add to Order
                </button>
              </div>
            </div>
            <div class="clearfix"></div>
            <app-variant-detail [showEdit]="showEdit"
              [variant]="variant"
              *ngIf="variant.detailView">
            </app-variant-detail>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div id="info">
    <div class="inner uptracker-form">
      <div class="row">
        <div class="ttl col s12">
          Description
        </div>
        <div *ngIf="showEdit" class="col s12 textarea">
          <textarea placeholder="Type here" class="col s12 " [(ngModel)]="productCopy.description"></textarea>
        </div>
        <div *ngIf="!showEdit" class="col s12 bold">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
          et dolore
          magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
          ea commodo
          consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
          nulla
          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
          anim id
          est laborum.
        </div>
      </div>
      <div class="row">
        <div class="ttl col s12">
          Notes
        </div>
        <div *ngIf="showEdit" class="col s12 textarea">
          .
          <textarea placeholder="Type here" class=" col s12 " [(ngModel)]="productCopy.notes"></textarea>
        </div>
        <div *ngIf="!showEdit" class="col s12 bold">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
          et dolore
          magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
          ea commodo
          consequat.
        </div>
      </div>
      <div class="row mbot0">
        <div class="col s6 ">
          <div class="row mbot0">
            <div class="ttl col s12">
              MSDS
            </div>
            <div *ngIf="showEdit" class="col s12 input">
              <input placeholder="Enter URL" class="col s12" [(ngModel)]="productCopy.msds" type="text">
            </div>
            <div *ngIf="!showEdit" class="col s12">
              <a href="#">http://link.com/</a>
            </div>
          </div>
          <div *ngIf="!showEdit" class="row">
            <div class="ttl col s12">
              Hazardous Form
            </div>
            <div class="col s12">
              <a href="#">http://link.com/</a>
            </div>
          </div>
        </div>
        <div class="col s6 ">
          <div *ngIf="showEdit" class="row mbot0">
            <div class="ttl col s12">
              Hazardous Form
            </div>
            <div class="col s12 input">
              <input placeholder="Enter URL" class="col s12" [(ngModel)]="productCopy.hazardous_form"
                type="text">
            </div>
          </div>
          <div *ngIf="!showEdit" class="row">
            <div class="ttl col s12">
              Documents
            </div>
            <div class="col s12">
              <a href="#">Product Spec.pdf</a>
              <br>
              <a href="#">Order Form.pdf/</a>
              <br>
              <a href="#">Marketing.pdf/</a>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="showEdit" class="row">
        <div class="ttl col s12 mbot10">
          Documents
        </div>
        <div class="col s6">
          <div class="img-container-edit col s12" title="Drop files here" fileDrop
            [ngClass]="{'file-is-over': fileIsOver}"
            [options]="options"
            (fileOver)="fileOver($event)"
            (onFileDrop)="onFileDrop($event)">
          </div>
        </div>
        <div *ngIf="hasDocs" class="col s6">
          <div *ngFor="let file of files$ | async; let index = $index">
            <div class="col s10">
              <a href="#">{{file.name}}</a>
            </div>
            <div class="col s2" (click)="removeFile(file, index)">
              <i class="fa fa-trash"></i>
            </div>
          </div>
          <!--<div class="col s10">-->
          <!--<a href="#">Order Form.pdf</a>-->
          <!--</div>-->
          <!--<div class="col s2" (click)="removeDoc()">-->
          <!--<i class="fa fa-trash"></i>-->
          <!--</div>-->
          <!--<div class="col s10">-->
          <!--<a href="#">Marketing.pdf</a>-->
          <!--</div>-->
          <!--<div class="col s2" (click)="removeDoc()">-->
          <!--<i class="fa fa-trash"></i>-->
          <!--</div>-->
        </div>
        <div *ngIf="!hasDocs" class="col s6 no-docs">
          <div class="ttl">Document</div>
          <div class="grey-text mbot10">Please upload documents with max size 10MB</div>
          <div>
            <a href="#">Upload a document</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="inventory">
    <div class="inner">
      <div class="variant-table">
        <div class="uptracker-form variant-head">
          <div class="head-item">
            Variation
          </div>
          <div class="head-item">
            Total
          </div>
          <div class="head-item">
            Primary Location
          </div>
          <div class="head-item">
            Secondary Location
          </div>
          <div class="head-item">
            Tertiary Location
          </div>
          <div class="clearfix"></div>
        </div>
      </div>

      <div class="table-body">
        <div class="variant-table">
          <div class="uptracker-form  table-item" *ngFor="let variant of filteredVariants$ | async">

            <div class="name-heading variant-name row-item valign-wrapper">
                        <span [class.reddish]="variant.status == 2" class="valign"
                          (click)="toggleVariantDetailView(variant)">{{variant.name || "Product Here"}}
                        </span>
            </div>
            <div class="small-heading row-item">{{variant.total_inventory}}</div>
            <div *ngFor="let inv of variant.inventory; let i=index;"
              [class.selected]="currentLocation[variant.id] ? (inv.location_id==currentLocation[variant.id] && variant.detailView) : (i==0 && variant.detailView)"
              class="small-heading row-item"
              (click)="changeSelected(inv.location_id,variant.id)">{{inv.current_inventory}}
            </div>
            <div class="clearfix"></div>
            <div *ngIf="variant.detailView">
              <div *ngFor="let inv of variant.inventory; let i=index;">
                <div *ngIf="currentLocation[variant.id] ? inv.location_id==currentLocation[variant.id] : i==0">
                  <app-inventory-detail
                    [(vis)]="variant.detailView"
                    [variant]="inv">
                  </app-inventory-detail>
                </div>
              </div>
              <div class="right variant-detail-collapse">
                <span (click)="inventoryDetailCollapse(variant)"><i class="fa fa-chevron-up" aria-hidden="true"></i> Collapse</span>
              </div>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="tracking" *ngIf="product.trackable">
    <div class="inner">
      Tracking tab
    </div>
  </div>
  <div id="history">
    <div class="inner">
      <div class="variant-table">
        <div class="uptracker-form variant-head">
          <div class="head-item">
            Variation
          </div>
          <div class="head-item">
            Qty
          </div>
          <div class="head-item">
            Location
          </div>
          <div class="head-item">
            Status
          </div>
          <div class="head-item">
            Ordered
          </div>
          <div class="head-item">
            Received
          </div>
          <div class="clearfix"></div>
        </div>
      </div>

      <div class="table-body">
        <div class="variant-table">
          <div class="uptracker-form  table-item" *ngFor="let variant of filteredVariants$ | async">
            <div class="name-heading variant-name row-item valign-wrapper">
                            <span [class.reddish]="variant.status == 2" class="valign"
                              (click)="toggleVariantDetailView(variant)">{{variant.name || "Product Here"}}</span>
            </div>
            <div class="small-heading row-item">3</div>
            <div class="small-heading row-item">Primary Location</div>
            <div class="small-heading row-item">Pending</div>
            <div class="small-heading row-item">12/12/16</div>
            <div class="small-heading row-item">12/12/16</div>
            <div class="clearfix"></div>
            <app-history-detail [variant]="variant" *ngIf="variant.detailView"></app-history-detail>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div id="comments">
    <div class="inner">

      <form class="uptracker-form" (submit)="sendComment()" #commentForm="ngForm" novalidate autocomplete="off">
        <div class="input row textarea-row">
          <div class="label col s12">Add Comment</div>
          <div class="col s10">
            <div class="textarea">
              <textarea id="comments-textarea" class="validate materialize-textarea" name="comment_body" required
                #inputComment [(ngModel)]="comment.body"></textarea>
            </div>
          </div>
          <div class="buttons col s2">
            <button class="btn white-text waves-effect waves-light" [disabled]="!commentForm.valid">Send
            </button>
          </div>
        </div>
      </form>

      <div class="comments">
        <ul class="collection">
          <li class="collection-item avatar" *ngFor="let comment of filteredComments$ | async">
            <img [src]="comment.author_avatar || ''" class="responsive-img circle author-avatar">
            <span class="title">{{comment.author_name}}</span>
            <span class="date">{{comment.created_at}}</span>
            <span class="edit-comment" *ngIf="comment.author_id==userService.selfData.id"
              (click)="editComment(comment)">
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </span>
            <p [innerHtml]="comment.body"></p>
            <div class="secondary-content" *ngIf="comment.author_id==userService.selfData.id">
              <div class="delete-comment " (click)="deleteComment(comment)">
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
